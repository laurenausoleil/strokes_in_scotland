---
title: "Strokes in Scotland Data Report"
author: "Lauren Davidson"
date: "09/03/2021"
output: html_document
---

----
How can Scottish health services most effectively prevent and treat stroke diagnoses?
----

#### Background
"Cerebrovascular disease develops as a result of problems with the blood vessels supplying oxygen rich blood to the brain.
Scotland has a high prevalence of the risk factors associated with cerebrovascular disease such as smoking and high blood pressure. Despite a substantial decrease in rates of death over the lastdecade, treating and preventing stroke is a national clinical priority for Scotland as outlined in the Stroke Improvement Plan."
  - 2020-01-28-stroke-summary.pdf from https://beta.isdscotland.org/find-publications-and-data/conditions-and-diseases/stroke-statistics/scottish-stroke-statistics/

Original brief accessible in documentation folder of this project.

#### Data

##### Sources

**Scottish Stroke Statistics: Stroke Activity By Health Board/Council Area 2009 - 2018**
Number of discharges, crude rate and EASR per 100,000 population by year, gender, age, sex and council area OR NHS board.
https://www.opendata.nhs.scot/dataset/scottish-stroke-statistics

**Scottish Stroke Statistics: Stroke Mortality By Health Board/Council Area 2009/10 - 2018/19**
Number of mortalities, crude rate and EASR per 100,000 population by year, gender, age, sex and council area OR NHS board.
https://www.opendata.nhs.scot/dataset/scottish-stroke-statistics

**Inpatient and Daycare Administrative Dataset 2014/15 - 2018/19**
Hospital stays and crude rate per 100,000 population by year, gender, age, sex and council area OR NHS board.
https://www.isdscotland.org/Health-Topics/Hospital-Care/Diagnoses/

**IS1 - Cerebrovascular Disease incidence by health board, age group and sex**
Cases, crude rate and EASR per 100,000 population per year, health board, age group and sex.
https://www.isdscotland.org/Health-Topics/Stroke/Publications/data-tables2017.asp

**DS1 - Cerebrovascular Disease and deprivation; standardised mortality ratios (SMR) by age group and SIMD deciles**
https://www.isdscotland.org/Health-Topics/Stroke/Publications/data-tables2017.asp

**DS4 - Trends in stroke hospital activity by SIMD quintile**
Hospital stays, crude rate and EASR per 100,000 population by year and SIMD
https://www.isdscotland.org/Health-Topics/Stroke/Publications/data-tables2017.asp

##### Structure

```{r, echo=FALSE, out.width = '100%', fig.align = 'left'}
knitr::include_graphics("images/updated_data_model_diagram.png")
```

##### Data Quality Issues

* All data from reputable sources. Minimal bias and quality issues assumed.

* All identifiable data removed by publishers.

* Datasets vary in use of financial or calendar year so an approximate calendar year is generated from financial year in order to compare datasets.

* Datasets vary in age groupings presented.

* Significant number of empty fields in the data. Where summary statistics are calculated, empty fields are ignored.

----
Analysis - findings and visualisations
----

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, out.width = '100%')
library(tidyverse)
```

```{r}
council_strokesbyca <- read_csv("../data/clean_data/strokes_byca.csv",
                                col_types = cols(hospitalstays = col_double(),
                                            crude_rate_stays = col_double()))
healthboard_strokesbyhb <- read_csv("../data/clean_data/strokes_byhb.csv",
                                col_types = cols(hospitalstays = col_double(),
                                            crude_rate_stays = col_double()))

council_strokesbyca <- read_csv("../data/clean_data/strokes_byca.csv",
                                col_types = cols(hospitalstays = col_double(),
                                            crude_rate_stays = col_double()))
healthboard_strokesbyhb <- read_csv("../data/clean_data/strokes_byhb.csv",
                                col_types = cols(hospitalstays = col_double(),
                                            crude_rate_stays = col_double()))

incidence_by_hb <- read_csv("../data/clean_data/incidence_byhb.csv")

discharges_bysimd <- read_csv("../data/clean_data/discharges_bysimd.csv")

mortality_bysimd <- read_csv("../data/clean_data/mortality_bysimd2013-2017")
```


#### What is the most common stroke diagnosis in Scotland?

* For both healthboard and council area, CD is the most common stroke diagnosis recorded for hospital stays, hospital discharges and deaths.

**Table summarising key metrics by diagnosis**

```{r}
knitr::kable(council_strokesbyca %>% 
  group_by(diagnosis) %>% 
  summarise(avg_discharge_easr = mean(easr_discharge, na.rm = TRUE),
            avg_deaths_easr = mean(easr_mortality, na.rm = TRUE),
            prop_death_by_discharge = avg_deaths_easr / avg_discharge_easr * 100) %>% 
  rename("Diagnosis" = "diagnosis",
         "Discharge (EASR)" = "avg_discharge_easr",
         "Mortality (EASR)" = "avg_deaths_easr",
         "Number of Deaths per 100 Discharges" = "prop_death_by_discharge")
)
```

#### Are there differences in mortality rates for different types of stroke? Does this vary with demographics?

* CD is the biggest killer per 100 discharges from hospital followed by Stroke and SH.

# Come back to this section to answer Does this vary with demographics?

```{r}
council_strokesbyca %>% 
# filter year to remove high values from years prior to 2013 in order to make graph more readable
  filter(age_group != "All" & age_group != "under75 years" & approx_year > 2013) %>% 
  group_by(age_group, approx_year, diagnosis) %>% 
  summarise(mortality = mean(easr_mortality, na.rm = TRUE)) %>% 
  ggplot() +
  aes(x = approx_year, y = mortality, group = diagnosis, col = diagnosis) +
  geom_line() +
  facet_wrap(~age_group) +
  labs(
    title = "Mortality by age and diagnosis over time"
  )
```
* Mortality rates have fallen for the 75+ group with CD and Stroke.
* Mortality rates have remained static for all other age and diagnosis groupings.

#### Are there any differences in reporting between health board and local authority?

* No significant discrepancies found.

#### Are there any differences in stroke diagnoses between different demographics?

##### Gender

* Women die from SH proportionally more than men.
```{r}
council_strokesbyca %>% 
  group_by(sex, diagnosis) %>%
  summarise(mortality = mean(easr_mortality, na.rm = TRUE)) %>% 
  ggplot() +
    aes(x = diagnosis, y = mortality, group = sex, fill = sex) +
  geom_col(position = "fill") +
  labs(
    title = "Proportion of mortalities for each diagnosis",
    subtitle = "Separated by gender"
  )
```
  
* Men have higher rates of incidence than women and other genders

```{r}
incidence_by_hb %>% 
  group_by(sex, year) %>% 
  summarise(incidence = mean(easr, na.rm = TRUE)) %>% 
  ggplot() +
  aes(x = year, y = incidence, group = sex, col = sex) +
  geom_line() +
  labs(
    title = "Incidents by Gender 2009-2018"
  )
```

* All genders trending in decrease of incidents
* Female incidence rates are the most volatile.
* Female incidents rising since 2016, all genders slightly increasing since 2016.

* Mortality does not vary significantly with gender
```{r}
council_strokesbyca %>% 
  group_by(sex, approx_year) %>% 
  summarise(mortality = mean(easr_mortality, na.rm = TRUE)) %>% 
  ggplot() +
  aes(x = approx_year, y = mortality, group = sex, col = sex) +
  geom_line() +
  labs(
    title = "Mortality by Gender 2009-2018"
  )
```

* Although men have higher incidence rates than women, they have similar levels of mortality. More women die per episode of stroke diagnosis than men.

##### Age

* Mortality, discharge and proportion of deaths per discharge increase with age.

**Table summarising key metrics by age group**
```{r}
knitr::kable(council_strokesbyca %>% 
  filter(age_group != "All" & age_group != "under75 years") %>% 
  group_by(age_group) %>% 
  summarise(avg_discharge_easr = mean(easr_discharge, na.rm = TRUE),
            avg_deaths_easr = mean(easr_mortality, na.rm = TRUE),
            prop_death_by_discharge = avg_deaths_easr / avg_discharge_easr * 100) %>% 
  rename("Age Group" = "age_group",
         "Discharge (EASR)" = "avg_discharge_easr",
         "Mortality (EASR)" = "avg_deaths_easr",
         "Number of Deaths per 100 Discharges" = "prop_death_by_discharge")
)
```
  
  * Mortality by stroke has decreased significantly for the over 75 group between 2009 and 2018
  * Mortality rates for all other age groups have remained static in this time

```{r}
council_strokesbyca %>% 
  group_by(age_group, diagnosis) %>%
  summarise(discharges = mean(easr_discharge, na.rm = TRUE)) %>% 
  ggplot() +
    aes(x = age_group, y = discharges, group = diagnosis, fill = diagnosis) +
  geom_col(position = "fill") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(
    title = "Proportion of discharges by diagnoses and age group"
  )
```
* Stroke discharges increase with age group.
* CD is the most common diagnosis and accounts for consistent proportion of discharges across all age groups.
* SH accounts for a proportion of hospital activity in younger age groups than in older age groups.

```{r}
council_strokesbyca %>% 
  group_by(age_group, diagnosis) %>%
  summarise(mortality = mean(easr_mortality, na.rm = TRUE)) %>% 
  ggplot() +
    aes(x = age_group, y = mortality, group = diagnosis, fill = diagnosis) +
  geom_col(position = "fill") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(
    title = "Proportion of mortalities by diagnoses and age group"
  )
```

  * Stroke accounts for consistent proportion of mortalities across all age groups.
  * CD is the highest killer for all age groups and proportion of death by CD increases with age.
  * SH causes a higher proportion of fatalities in younger age groups than in older age groups.

```{r}
council_strokesbyca %>% 
  group_by(age_group, diagnosis) %>%
  summarise(discharges = mean(easr_discharge, na.rm = TRUE),
            mortality = mean(easr_mortality, na.rm = TRUE)) %>% 
  ggplot() +
    aes(x = age_group, y = mortality / discharges * 100, 
        group = diagnosis, fill = diagnosis) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(
    title = "Percentage of deaths by hospital discharges",
    subtitle = "shown by diagnoses and age group"
  )
```
* Number of deaths per 100 discharges increases with age group.
* SH is the most fatal diagnosis for all groups under 75 years.
* Death by stroke does not increase as significantly for stroke diagnosis in the 75 plus age group as it does for all other age groups.

* No trends found in SH diagnosis by age over time

##### Gender and Age
##### Healthboard
##### Council
##### SIMD
##### Age Group and SIMD

----
Key findings and Recommendations
----

* CD is the most common and fatal diagnosis
* Mortality rates have fallen for the 75+ group with CD and Stroke, but not for any other age and diagnosis group (most of the change in mortality rates we publicise is in one area, have we been tagertting this are and what can we learn from it?)

* Women die from SH proportionally more than men.
* All gender mortalities trending in decrease.
* Female incidence rates are the most volatile.
* Female incidents rising since 2016, all genders slightly increasing since 2016.
* More women die per episode of stroke diagnosis than men.
* SH causes a higher proportion of fatalities in younger age groups than in older age groups.
* SH is the most fatal diagnosis for all groups under 75 years.
* CD is the highest killer for all age groups and proportion of death by CD increases with age.



# Notable findings

*
*

#### How can Scottish health services most effectively prevent and treat stroke diagnoses?
#### What measures have been successful in the treatment and prevention of stroke?
#### Which demographics should we target for stroke intervention?


----
Additional Information
----

#### Methodology

##### Metrics Chosen

mean/median

##### Tools Used

##### Project Structure

#### Definitions

**Stroke**

* One of three possible diagnoses of Cerebrovascular diseases.
* Used in report and analysis to refer to all Cerebrovascular Diseases to aid ease of understanding.

**Subarachnoid Haemorrhage**

* One of three possible diagnoses of Cerebrovascular diseases.

**TIAs and other symptoms**

* Transient Ischemic Attacks (commonly known as mini-strokes) and other symptoms
* One of three possible diagnoses of Cerebrovascular diseases.

**Cerebrovascular Disease**

* "Cerebrovascular Disease (CVD) is a condition that develops as a result of problems with the blood vessels supplying the brain. This can cause a stroke, a transient ischaemic attack (TIA) or a subarachnoid haemorrhage."
*   - From Scottish Government Stroke Improvement Plan, 2014, accessed at https://www.gov.scot/publications/stroke-improvement-plan/pages/3/

**Crude Rate**

**EASR**

**SMR**
  
#### Assumptions

* financial year can be compared to calendar year without signifcantly undermining the analysis

* ambiguously named and defined crude rates in individual datasets refer to the crude rate of the dataset's subject variable.
e.g. EASR and crude rate in mortalitybyca refer to mortality per 100,000, EASR and crude rate in activitybyca refer to discharges per 100,000 and in diagnosis-by-counil-area refer to hospital stays per 100,000.

Qualifiers removed, but could be used for extension work.

Losing detail of age groupings from hospital stays will not affect analysis /
The larger age groupings will allow for a broader, but easier to interpret analysis.

Use EASR whenever available to normalise rates by European standards.
Order of preference for adjusted metrics: EASR, SMR, crude.

Use mean as standard method of assimilating rates in order to visualise differences in demographics more clearly.

#### Data Assessment

Copy from data analysis plan.